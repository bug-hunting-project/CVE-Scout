from flask import request
from flask_restx import Namespace, Resource

def search():
    api = Namespace("search", description="Database 관련 API")

    @api.route("/<string:keyword>")
    class CveByPlatform(Resource):
        @api.doc(
            params={"keyword": "Search keyword", "page": "Page number"},
            responses={200: "Success"},
            description="특정 키워드를 가진 CVE ID 리스트 출력",
        )
        def get(self, keyword):
            page = int(request.args.get("page", 1))
            nvd = NVD_CVE_Parser(
                api_url="https://services.nvd.nist.gov/rest/json/cves/2.0/"
            )

            results_per_page = 2000

            result = nvd.fetch_cve_data_with_keyword(
                (page - 1) * results_per_page,
                results_per_page,
                keyword=keyword,
                exact_match=True,
            )

            if not result:
                result = "No more results"

            return {"cve": result}, 200
            
    return api