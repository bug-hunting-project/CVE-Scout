from DB import Sqlite_Handler


Sqlite_Handler.wget_download_csv(
    csv_url="https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv", 
    csv_path="/home/lrtk/CVE-Scout/kev.csv"
)

# Initialize handler
handler = Sqlite_Handler("/home/lrtk/.cache/grype/db/5/vulnerability.db")

# Define a test schema
schema = {
    'cveID': 'TEXT',
    'vendorProject': 'TEXT',
    'product': 'TEXT',
    'vulnerabilityName': 'TEXT',
    'dateAdded': 'DATE',
    'shortDescription': 'TEXT',
    'requiredAction': 'TEXT',
    'dueDate': 'DATE',
    'notes': 'TEXT'
}

# Delete the table
if handler.delete_table("kev"):
    print("Successfully deleted table.")
else:
    print("Failed to delete table or table does not exist.")

# Create a new table
if handler.create_table("kev", schema):
    print("Successfully created table.")
else:
    print("Failed to create table or table already exists.")

print(handler.import_csv(
    csv_path="/home/lrtk/CVE-Scout/kev.csv", 
    table_name="kev", 
    schema=schema
))