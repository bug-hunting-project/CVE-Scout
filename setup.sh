#!/bin/bash

# Step 1: Check if Python 3 is installed
if command -v python3 &>/dev/null; then
    echo "Python 3 is installed."
else
    echo "Python 3 is not installed. Please install."
    exit 1
fi

# Step 2: Install Python libraries (TODO: Update when requirements.txt is ready)
if [ -f "requirements.txt" ]; then
    pip3 install -r requirements.txt
else
    echo "requirements.txt not found. Skipping library installation."
fi

# Step 3: Check if MongoDB is installed
if command -v mongod &>/dev/null; then
    echo "MongoDB is installed."
else
    echo "MongoDB is not installed. Please install."
fi

# Step 4: Install Grype and Syft if not installed
if ! command -v grype &>/dev/null; then
    echo "Grype is not installed. Installing..."
    
    # Installation command for Grype
    curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin
fi

if ! command -v syft &>/dev/null; then
    echo "Syft is not installed. Installing..."
    
    # Installation command for Syft
    curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin
fi

if [ ! -d ".config" ]; then
    mkdir .config
fi
DB_PATH=$(find ~/.cache -name "vulnerability.db" 2>/dev/null)
echo "$DB_PATH" > .config/db_path 

echo "Setup complete."